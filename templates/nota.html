<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Nota Harian Petani</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

    <style>
      @media print {
        body {
          font-size: 12px;
        }

        .container {
          max-width: 100%;
          margin: 0;
          padding: 0;
        }

        .table {
          font-size: 12px;
        }

        .d-print-none {
          display: none !important;
        }

        @page {
          size: A5 portrait;
          margin: 10mm;
        }

        h2, h4 {
          text-align: center;
        }

        table {
          width: 100%;
          border-collapse: collapse;
        }

        th, td {
          padding: 4px;
          border: 1px solid #000;
        }

        .fw-bold td {
          font-weight: bold;
        }

        .nota-tanggal {
          font-size: 14px;
          margin-bottom: 8px;
          text-align: center;
        }
      }
    </style>
  </head>
  <body class="p-4">
    <div class="container">
      <div class="d-print-none mb-4">
        <h2 class="mb-4">Nota Harian Petani</h2>

        <form method="get" class="mb-4 row g-3">
          <div class="col-auto">
            <label for="tanggal">Tanggal:</label>
            <input type="date" name="tanggal" id="tanggal" value="{{ tanggal }}" class="form-control" onchange="this.form.submit()" />
          </div>
          <div class="col-auto">
            <label for="petani">Petani:</label>
            <select name="petani" id="petani" class="form-select" onchange="this.form.submit()">
              <option value="">Semua</option>
              {% for p in semua_petani %}
                <option value="{{ p }}" {% if petani_filter == p %}selected{% endif %}>{{ p }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-auto align-self-end">
            <button onclick="window.print()" class="btn btn-primary">üñ®Ô∏è Cetak Nota</button>
          </div>
        </form>
      </div>

      {% for petani, records in data.items() %}
      <div class="mb-4 border p-3 bg-light">
        <div class="nota-tanggal"><strong>Tanggal:</strong> {{ tanggal }}</div>
        <h4>{{ petani }}</h4>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Sayur</th>
              <th>Grade</th>
              <th>Total Berat (kg)</th>
              <th>Harga Per Kg</th>
              <th>Total Uang</th>
            </tr>
          </thead>
          <tbody>
            {% set total = namespace(jumlah=0) %}
            {% for row in records %}
            <tr>
              <td>{{ row.sayur }}</td>
              <td>{{ row.grade }}</td>
              <td>{{ '{:,.2f}'.format(row.total_berat).replace(",", "X").replace(".", ",").replace("X", ".") }}</td>
              <td>Rp {{ '{:,.0f}'.format(row.harga_per_kg) }}</td>
              <td>Rp {{ '{:,.0f}'.format(row.total_uang or 0) }}</td>
            </tr>
            {% set total.jumlah = total.jumlah + (row.total_uang or 0) %}
            {% endfor %}
            <tr class="fw-bold">
              <td colspan="4" class="text-end">Total</td>
              <td>Rp {{ '{:,.0f}'.format(total.jumlah) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      {% endfor %}

      <div class="d-print-none">
        <a href="/keuangan" class="btn btn-secondary mt-3">‚Üê Kembali</a>
        <a href="/" class="btn btn-secondary mt-3">Kembali ke Dashboard</a>
      </div>
    </div>
  </body>
</html>
